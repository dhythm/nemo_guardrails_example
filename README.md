# NeMo Guardrails Example

## 多言語（日本語）対応に関する注意点 (Notes on Multi-language (Japanese) Support)

このサンプルを日本語で動作させるにあたり、以下の2つの重要な点が判明しました。

### 1. ガードレール判定の応答形式について

`config/prompts.yml` などで定義する入力チェック用のプロンプト（例: `self_check_input`）は、**判定用のLLMからの応答として、必ず英語の `"yes"` または `"no"` を返すように指示する必要があります。**

当初、プロンプトを日本語化し、応答として「はい」/「いいえ」を期待しましたが、これではガードレールが正しく機能しませんでした。フレームワークの判定ロジックが、リテラルな文字列 `"yes"`/`"no"` に依存しているためです。

**修正例 (`prompts.yml`):**
```yaml
  - task: self_check_input
    content: |-
      あなたは、与えられた指示が、...有害な内容を含んでいるかどうかを判断するAIです。
      ...有害な内容が含まれている場合は「yes」、含まれていない場合は「no」とだけ答えてください。
```

### 2. `stream_async` の問題と `generate_async` への切り替え

入力ガードレールをパスした安全なはずの質問に対し、LLMからの応答が空になる問題が発生しました。

これは `LLMRails` インスタンスの `stream_async` 関数に起因する問題のようでした。設定を様々に変更しても解決しませんでしたが、**ストリーミングを諦め、`generate_async` 関数（一括応答生成）に切り替えることで、この問題は解決しました。**

多言語対応や特定の構成でストリーミングがうまく機能しない場合は、`generate_async` を代替手段として使用することが有効です。